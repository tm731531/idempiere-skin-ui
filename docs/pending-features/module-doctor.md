# 醫生模組功能規格

## 概述

醫生看診使用的功能，包含叫號、看診紀錄、開藥。

**優先級：P0（最高）**
**使用設備：平板**

---

## 1. 看診主畫面

### 1.1 UI 需求

```
┌─────────────────────────────────────────────────┐
│  👨‍⚕️ 陳醫師 看診中              候診: 5 人 🔴  │
├─────────────────────────────────────────────────┤
│                                                 │
│  目前看診: 15 號 王小明 (男/46歲)               │
│  ⚠️ 注意病人  💊 過敏: 青黴素                   │
│                                                 │
├─────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────────────────┐   │
│  │ 歷史紀錄    │  │ 處方                    │   │
│  ├─────────────┤  ├─────────────────────────┤   │
│  │ 2026/01/20  │  │ 診斷: [感冒        ▼]  │   │
│  │ 感冒        │  │                         │   │
│  │ 科學中藥x3  │  │ ┌─────────────────────┐ │   │
│  ├─────────────┤  │ │ + 新增藥品          │ │   │
│  │ 2025/12/15  │  │ └─────────────────────┘ │   │
│  │ 腸胃炎      │  │                         │   │
│  │ 科學中藥x2  │  │ 藥品清單:               │   │
│  └─────────────┘  │ ├─ 感冒方 3g TID x7    │   │
│                   │ ├─ 咳嗽方 2g TID x7    │   │
│                   │ └─ 頭痛方 1.5g BID x7  │   │
│                   │                         │   │
│                   │ 總天數: 7 天            │   │
│                   └─────────────────────────┘   │
│                                                 │
├─────────────────────────────────────────────────┤
│  [ 叫下一位 ]              [ 完成看診 ]         │
└─────────────────────────────────────────────────┘
```

### 1.2 功能需求

| 功能 | 說明 | 狀態 |
|------|------|------|
| 病人資訊顯示 | 姓名、年齡、性別、標記 | ❌ 未實作 |
| 歷史紀錄查看 | 過去看診與用藥紀錄 | ❌ 未實作 |
| 過敏警示 | 顯著提示過敏史 | ❌ 未實作 |
| 候診人數 | 即時顯示候診數 | ❌ 未實作 |
| 叫號功能 | 叫下一位病人 | ❌ 未實作 |

---

## 2. 開藥功能

### 2.1 開藥流程

```
選擇診斷
    ↓
[使用處方組合?] → 載入常用組合
    ↓
新增/調整藥品
    ↓
設定劑量、頻率、天數
    ↓
檢查交互作用
    ↓
確認健保點數
    ↓
完成處方
```

### 2.2 藥品搜尋

```
┌─────────────────────────────────────┐
│  搜尋藥品                           │
├─────────────────────────────────────┤
│  🔍 [ 搜尋藥品名稱或代碼...    ]    │
│                                     │
│  常用藥品:                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐│
│  │ 感冒方  │ │ 咳嗽方  │ │ 胃藥方  ││
│  └─────────┘ └─────────┘ └─────────┘│
│                                     │
│  處方組合:                          │
│  ┌─────────────────────────────┐   │
│  │ 📋 感冒三合一                │   │
│  │    感冒方+咳嗽方+解熱方      │   │
│  ├─────────────────────────────┤   │
│  │ 📋 腸胃調理                  │   │
│  │    健胃方+整腸方             │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 2.3 藥品明細編輯

```
┌─────────────────────────────────────┐
│  編輯藥品 - 感冒方                  │
├─────────────────────────────────────┤
│                                     │
│  劑量: [ 3    ] g                   │
│                                     │
│  頻率: ○ QD  ● TID  ○ BID  ○ QID   │
│                                     │
│  天數: [ 7    ] 天                  │
│                                     │
│  總量: 63 g                         │
│                                     │
│  備註: [                       ]    │
│                                     │
├─────────────────────────────────────┤
│     [ 取消 ]      [ 確認 ]          │
└─────────────────────────────────────┘
```

### 2.4 功能需求

| 功能 | 說明 | 狀態 |
|------|------|------|
| 藥品搜尋 | 名稱/代碼/健保碼 | ❌ 未實作 |
| 常用藥品 | 顯示該醫師常開藥品 | ❌ 未實作 |
| 處方組合 | 一鍵載入多藥組合 | ❌ 未實作 |
| 劑量設定 | 數字鍵盤輸入 | ❌ 未實作 |
| 頻率選擇 | QD/BID/TID/QID/PRN | ❌ 未實作 |
| 天數設定 | 1-28 天 | ❌ 未實作 |
| 交互作用檢查 | 自動檢查藥物衝突 | ❌ 未實作 |
| 過敏檢查 | 比對病人過敏史 | ❌ 未實作 |
| 總量計算 | 自動計算總用量 | ❌ 未實作 |

### 2.5 資料結構

```typescript
interface ConsultationSession {
  registrationId: number
  patient: Patient
  doctor: Doctor
  startTime: Date

  // 診斷
  diagnosis: {
    code: string              // ICD-10
    name: string              // 診斷名稱
    note?: string             // 備註
  }

  // 處方
  prescription: {
    lines: PrescriptionLine[]
    totalDays: number
    nhiPoints: NHIPointsSummary
  }

  // 歷史紀錄
  history: ConsultationHistory[]
}

interface PrescriptionLine {
  productId: number
  productName: string
  dosage: number              // 每次劑量
  unit: string                // g, ml, 顆
  frequency: 'QD' | 'BID' | 'TID' | 'QID' | 'PRN'
  days: number
  route: 'PO' | 'EXT'         // 口服/外用
  totalQuantity: number       // 自動計算
  instructions?: string
}

interface PrescriptionTemplate {
  id: number
  name: string
  description?: string
  doctorId?: number           // null = 共用
  lines: Omit<PrescriptionLine, 'totalQuantity'>[]
}
```

---

## 3. 處方組合管理

### 3.1 UI 需求

```
┌─────────────────────────────────────┐
│  處方組合管理                       │
├─────────────────────────────────────┤
│  [ + 新增組合 ]                     │
│                                     │
│  我的組合:                          │
│  ┌─────────────────────────────┐   │
│  │ 📋 感冒三合一            [編輯] │
│  │    感冒方 3g TID              │   │
│  │    咳嗽方 2g TID              │   │
│  │    解熱方 1.5g TID            │   │
│  ├─────────────────────────────┤   │
│  │ 📋 腸胃調理              [編輯] │
│  │    健胃方 2.5g TID            │   │
│  │    整腸方 2g BID              │   │
│  └─────────────────────────────┘   │
│                                     │
│  共用組合:                          │
│  ┌─────────────────────────────┐   │
│  │ 📋 標準感冒方                 │   │
│  │ 📋 過敏調理                   │   │
│  │ 📋 睡眠調理                   │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

### 3.2 功能需求

| 功能 | 說明 | 狀態 |
|------|------|------|
| 建立組合 | 新增處方組合 | ❌ 未實作 |
| 編輯組合 | 修改現有組合 | ❌ 未實作 |
| 刪除組合 | 移除不用的組合 | ❌ 未實作 |
| 個人/共用 | 區分個人與共用組合 | ❌ 未實作 |
| 使用頻率排序 | 常用的排前面 | ❌ 未實作 |

---

## 4. 藥物交互作用檢查

### 4.1 警示等級

| 等級 | 圖示 | 說明 | 處理 |
|------|------|------|------|
| 嚴重 | 🔴 | 禁止併用 | 強制阻止 |
| 中度 | 🟡 | 需注意 | 提醒確認 |
| 輕度 | 🟢 | 一般提醒 | 顯示資訊 |

### 4.2 警示畫面

```
┌─────────────────────────────────────┐
│  ⚠️ 藥物交互作用警示                │
├─────────────────────────────────────┤
│                                     │
│  🔴 嚴重警告                        │
│  ┌─────────────────────────────┐   │
│  │ 藥品A × 藥品B                 │   │
│  │ 可能導致嚴重副作用，禁止併用  │   │
│  └─────────────────────────────┘   │
│                                     │
│  🟡 注意事項                        │
│  ┌─────────────────────────────┐   │
│  │ 藥品C × 藥品D                 │   │
│  │ 可能降低藥效，建議間隔服用    │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│     [ 返回修改 ]  [ 確認開立 ]      │
└─────────────────────────────────────┘
```

---

## 5. 看診紀錄檢視

### 5.1 歷史紀錄列表

```
┌─────────────────────────────────────┐
│  王小明 看診紀錄                    │
├─────────────────────────────────────┤
│                                     │
│  2026/01/20 - 陳醫師                │
│  診斷: 感冒                         │
│  用藥: 感冒方、咳嗽方、解熱方       │
│  天數: 7 天                         │
│  [ 查看詳細 ] [ 複製處方 ]          │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  2025/12/15 - 林醫師                │
│  診斷: 腸胃炎                       │
│  用藥: 健胃方、整腸方               │
│  天數: 5 天                         │
│  [ 查看詳細 ] [ 複製處方 ]          │
│                                     │
└─────────────────────────────────────┘
```

### 5.2 功能需求

| 功能 | 說明 | 狀態 |
|------|------|------|
| 歷史列表 | 顯示過去看診紀錄 | ❌ 未實作 |
| 詳細檢視 | 查看完整處方內容 | ❌ 未實作 |
| 複製處方 | 複製歷史處方到當次 | ❌ 未實作 |
| 篩選功能 | 依日期/診斷篩選 | ❌ 未實作 |

---

## 6. 實作優先順序

### Phase 1: 基礎看診
1. [ ] 病人資訊顯示
2. [ ] 診斷選擇
3. [ ] 基本開藥（搜尋+新增）
4. [ ] 完成看診

### Phase 2: 處方功能
1. [ ] 處方組合載入
2. [ ] 劑量/頻率/天數調整
3. [ ] 健保點數計算
4. [ ] 歷史紀錄檢視

### Phase 3: 進階功能
1. [ ] 處方組合管理
2. [ ] 藥物交互作用檢查
3. [ ] 過敏檢查
4. [ ] 複製歷史處方

### Phase 4: 效率優化
1. [ ] 常用藥品排序
2. [ ] 快速輸入（語音？）
3. [ ] 自訂快捷鍵

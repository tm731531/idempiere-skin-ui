# 測試情境與測試資料

> 專案：iDempiere 醫療診所 UI
> 版本：1.0
> 日期：2026-02-06

---

## 1. 測試資料設計

### 1.1 藥品資料

| 藥品名稱 | 代碼 | 類型 | 單位 | 換算 | 藥房 | 庫房 | 前台 | 狀態 |
|---------|------|------|------|------|------|------|------|------|
| 甘草湯 | TCM001 | 科中 | 罐/g | 1罐=200g | 150g | 3罐 | 0 | 🟢 正常 |
| 銀翹散 | TCM002 | 科中 | 罐/g | 1罐=200g | 41g | 1罐 | 0 | 🟡 偏低 |
| 平胃散 | TCM003 | 科中 | 罐/g | 1罐=200g | 0 | 0 | 0 | 🔴 缺貨 |
| 枸杞 | HRB001 | 水藥 | 包/g | 1包=500g | 200g | 2包 | 50g | 🟢 正常 |
| 黃耆 | HRB002 | 水藥 | 包/g | 1包=300g | 50g | 0 | 0 | 🔴 缺貨 |
| 當歸 | HRB003 | 水藥 | 包/g | 1包=300g | 100g | 1包 | 0 | 🟡 偏低 |
| 感冒藥粉A | PWD001 | 藥粉 | 包/g | 1包=100g | 80g | 5包 | 20g | 🟢 正常 |

### 1.2 處方組合

| 組合名稱 | 所屬醫生 | 內容 |
|---------|---------|------|
| 感冒方 | 王醫師 | 銀翹散 30g + 甘草湯 50g + 桔梗 20g |
| 腸胃方 | 王醫師 | 平胃散 40g + 茯苓 30g |
| 補氣方 | 王醫師 | 黃耆 30g + 枸杞 20g + 當歸 15g |

### 1.3 廠商資料

| 廠商名稱 | 代碼 | 電話 | 主要品項 |
|---------|------|------|---------|
| 順天堂 | V001 | 02-1234-5678 | 科中、藥粉 |
| 港香蘭 | V002 | 02-2345-6789 | 科中 |
| 中藥行 | V003 | 02-3456-7890 | 水藥材 |

### 1.4 病人資料

| 姓名 | 健保卡號 | 年齡 | 標記 | 備註 |
|------|---------|------|------|------|
| 王大明 | A123456789 | 49 | ⚠️ 注意 | 對收費敏感 |
| 李小華 | B234567890 | 35 | - | - |
| 陳美美 | C345678901 | 62 | 🔄 慢性 | 高血壓 |
| 林大雄 | D456789012 | 28 | 💊 過敏 | 盤尼西林過敏 |
| 張小芬 | E567890123 | 45 | ❤️ VIP | 院長朋友 |
| 黃大頭 | F678901234 | 55 | ⚠️ 💰 | 有欠款紀錄、愛抱怨 |

### 1.5 使用者帳號

| 帳號 | 密碼 | 角色 | 姓名 |
|------|------|------|------|
| admin | admin123 | 管理員 | 系統管理員 |
| doctor1 | doc123 | 醫生 | 王醫師 |
| counter1 | cnt123 | 櫃檯 | 小美 |
| pharmacy1 | pha123 | 藥房 | 阿嬌 |
| warehouse1 | wh123 | 庫管 | 阿明 |
| warehouse2 | wh123 | 庫管/採購 | 小陳 |

---

## 2. 測試情境

### 2.1 掛號模組

#### TC-REG-001：正常複診掛號
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人李小華已有就診紀錄 |
| 步驟 | 1. 刷健保卡 B234567890<br>2. 確認顯示病人資料<br>3. 選擇「複診」<br>4. 按「確認掛號」 |
| 預期結果 | 進入候診列表，顯示排隊號碼 |

#### TC-REG-002：初診掛號（需填額外資料）
| 項目 | 內容 |
|------|------|
| 前置條件 | 新病人，系統無資料 |
| 步驟 | 1. 刷新健保卡<br>2. 系統顯示「初診」<br>3. 填寫地址、電話、緊急聯絡人<br>4. 按「確認掛號」 |
| 預期結果 | 建立新病人資料，進入候診 |

#### TC-REG-003：刷卡後取消
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人王大明 |
| 步驟 | 1. 刷健保卡<br>2. 顯示病人資料<br>3. 按「取消」 |
| 預期結果 | 返回刷卡畫面，不留掛號紀錄 |

#### TC-REG-004：顯示注意標記
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人王大明有 ⚠️ 標記 |
| 步驟 | 1. 刷健保卡 A123456789 |
| 預期結果 | 顯示 ⚠️ 注意標記和備註「對收費敏感」 |

#### TC-REG-005：慢性病直接領藥
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人陳美美有慢性處方箋，今日可領 |
| 步驟 | 1. 刷健保卡<br>2. 選擇「慢性領藥」<br>3. 確認 |
| 預期結果 | 跳過看診，直接進入配藥流程 |

#### TC-REG-006：每日額滿
| 項目 | 內容 |
|------|------|
| 前置條件 | 當日掛號已達 50 人上限 |
| 步驟 | 1. 刷健保卡<br>2. 嘗試掛號 |
| 預期結果 | 顯示「今日額滿」，建議預約其他日期 |

---

### 2.2 候診與叫號

#### TC-QUE-001：正常叫號
| 項目 | 內容 |
|------|------|
| 前置條件 | 候診列表有 3 人 |
| 步驟 | 1. 櫃檯按「叫號」 |
| 預期結果 | 第一位進入看診，螢幕顯示叫號 |

#### TC-QUE-002：調整順序
| 項目 | 內容 |
|------|------|
| 前置條件 | 候診列表有 5 人 |
| 步驟 | 1. 選擇 #3<br>2. 按「往上」 |
| 預期結果 | #3 變成 #2 |

#### TC-QUE-003：VIP 插隊
| 項目 | 內容 |
|------|------|
| 前置條件 | VIP 病人張小芬剛掛號 |
| 步驟 | 1. 選擇張小芬<br>2. 按「插隊」<br>3. 選擇插到第 1 位 |
| 預期結果 | 張小芬變成下一位看診 |

#### TC-QUE-004：暫離處理
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人說要去廁所 |
| 步驟 | 1. 選擇該病人<br>2. 按「暫離」 |
| 預期結果 | 標記為暫離，跳過但保留位置 |

---

### 2.3 看診與開藥

#### TC-CON-001：正常開藥
| 項目 | 內容 |
|------|------|
| 前置條件 | 醫生看診王大明 |
| 步驟 | 1. 搜尋「甘草」<br>2. 選擇甘草湯<br>3. 輸入 50g<br>4. 按「看診完成」 |
| 預期結果 | 處方建立，進入配藥列表 |

#### TC-CON-002：使用常用藥組合
| 項目 | 內容 |
|------|------|
| 前置條件 | 醫生有「感冒方」組合 |
| 步驟 | 1. 按「常用藥」<br>2. 選擇「感冒方」 |
| 預期結果 | 自動加入：銀翹散 30g + 甘草湯 50g + 桔梗 20g |

#### TC-CON-003：庫存不足警示
| 項目 | 內容 |
|------|------|
| 前置條件 | 平胃散庫存為 0 |
| 步驟 | 1. 搜尋「平胃散」 |
| 預期結果 | 顯示 🔴 缺貨，無法加入處方 |

#### TC-CON-004：藥房夠但需調撥提示
| 項目 | 內容 |
|------|------|
| 前置條件 | 銀翹散藥房剩 41g，庫房有 1 罐 |
| 步驟 | 1. 開銀翹散 50g |
| 預期結果 | 顯示 🟡，提示需從庫房調撥 |

#### TC-CON-005：顯示過敏警示
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人林大雄對盤尼西林過敏 |
| 步驟 | 1. 進入看診畫面 |
| 預期結果 | 明顯顯示 💊 過敏：盤尼西林 |

#### TC-CON-006：候診人數提醒
| 項目 | 內容 |
|------|------|
| 前置條件 | 候診 15 人 |
| 步驟 | 1. 進入看診畫面 |
| 預期結果 | 顯示 🔴 15 人 ⏰ |

---

### 2.4 配藥模組

#### TC-DIS-001：正常配藥完成
| 項目 | 內容 |
|------|------|
| 前置條件 | 王大明處方：甘草湯 50g |
| 步驟 | 1. 查看處方<br>2. 配好藥<br>3. 按「配藥完成」 |
| 預期結果 | 藥房甘草湯 -50g，進入結帳列表 |

#### TC-DIS-002：需調撥後配藥
| 項目 | 內容 |
|------|------|
| 前置條件 | 處方需 50g，藥房只有 41g |
| 步驟 | 1. 系統提示不足<br>2. 上樓掃碼調撥 1 罐<br>3. 配藥完成 |
| 預期結果 | 庫房 -1 罐，藥房 +200g -50g |

#### TC-DIS-003：調整實際用量
| 項目 | 內容 |
|------|------|
| 前置條件 | 處方 50g，實際罐子剩 41g |
| 步驟 | 1. 按「調整」<br>2. 改成 41g<br>3. 完成 |
| 預期結果 | 扣 41g，記錄調整 |

---

### 2.5 庫存管理

#### TC-INV-001：掃碼調撥
| 項目 | 內容 |
|------|------|
| 前置條件 | 庫房有甘草湯 3 罐 |
| 步驟 | 1. 進入調撥<br>2. 掃甘草湯條碼<br>3. 輸入 1 罐<br>4. 確認（庫房→藥房） |
| 預期結果 | 庫房 -1 罐，藥房 +1 罐，記錄調撥 |

#### TC-INV-002：開罐時 Double Check
| 項目 | 內容 |
|------|------|
| 前置條件 | 系統顯示庫房 2 罐 |
| 步驟 | 1. 系統提示開新罐<br>2. 輸入實際數量 3 罐 |
| 預期結果 | 修正庫存，記錄差異原因 |

#### TC-INV-003：盤點任務認領
| 項目 | 內容 |
|------|------|
| 前置條件 | 有未認領的盤點任務 |
| 步驟 | 1. 庫管按「接單」 |
| 預期結果 | 任務狀態變「進行中」，顯示認領人 |

#### TC-INV-004：盤點差異處理
| 項目 | 內容 |
|------|------|
| 前置條件 | 系統 3 罐，實際 2 罐 |
| 步驟 | 1. 輸入實際 2 罐<br>2. 選擇差異原因「損耗」<br>3. 確認 |
| 預期結果 | 庫存修正為 2 罐，記錄差異 |

---

### 2.6 採購模組

#### TC-PUR-001：建立採購單
| 項目 | 內容 |
|------|------|
| 前置條件 | 平胃散缺貨 |
| 步驟 | 1. 選擇廠商「順天堂」<br>2. 加入平胃散 5 罐<br>3. 送出訂單 |
| 預期結果 | 採購單建立，狀態「已訂貨」 |

#### TC-PUR-002：入庫
| 項目 | 內容 |
|------|------|
| 前置條件 | 有已訂貨的採購單 |
| 步驟 | 1. 廠商送貨<br>2. 掃碼入庫<br>3. 確認數量<br>4. 選擇倉位「庫房」 |
| 預期結果 | 庫房庫存增加，採購單「已完成」 |

#### TC-PUR-003：在途庫存顯示
| 項目 | 內容 |
|------|------|
| 前置條件 | 有已訂貨 5 罐，預計 01/28 到 |
| 步驟 | 1. 查看庫存 |
| 預期結果 | 顯示 📦 已訂: 5罐（01/28 到） |

---

### 2.7 結帳與退費

#### TC-PAY-001：正常結帳
| 項目 | 內容 |
|------|------|
| 前置條件 | 王大明藥已配好，金額 $350 |
| 步驟 | 1. 按「叫號結帳」<br>2. 選「現金」<br>3. 確認收款 |
| 預期結果 | 完成結帳，病人可離開 |

#### TC-PAY-002：退費（未配藥）
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人掛號後反悔 |
| 步驟 | 1. 選擇退費<br>2. 選擇「全額退」 |
| 預期結果 | 退款，庫存不動 |

#### TC-PAY-003：退費不退藥（奧客）
| 項目 | 內容 |
|------|------|
| 前置條件 | 黃大頭拿了藥後要求退費 |
| 步驟 | 1. 選擇退費<br>2. 記錄「退費不退藥」<br>3. 輸入原因 |
| 預期結果 | 退款，標記病人 ⚠️，記錄損失 |

#### TC-PAY-004：不付款跑掉
| 項目 | 內容 |
|------|------|
| 前置條件 | 藥配好，病人跑掉 |
| 步驟 | 1. 標記「未收款」 |
| 預期結果 | 藥報廢，病人標記 💰 欠款 |

---

### 2.8 預約模組

#### TC-APT-001：電話預約
| 項目 | 內容 |
|------|------|
| 前置條件 | 明天還有名額 |
| 步驟 | 1. 查詢明天額度<br>2. 輸入姓名/電話<br>3. 建立預約 |
| 預期結果 | 預約成功，明天名額 -1 |

#### TC-APT-002：預約報到
| 項目 | 內容 |
|------|------|
| 前置條件 | 病人有預約今天 |
| 步驟 | 1. 刷健保卡<br>2. 系統顯示「有預約」<br>3. 按「報到」 |
| 預期結果 | 進入候診，標記「預約」 |

#### TC-APT-003：額滿無法預約
| 項目 | 內容 |
|------|------|
| 前置條件 | 該日已滿 50 人 |
| 步驟 | 1. 嘗試預約該日 |
| 預期結果 | 顯示「已滿」，無法預約 |

---

### 2.9 水藥特殊流程

#### TC-WTR-001：水藥煮袋扣庫存
| 項目 | 內容 |
|------|------|
| 前置條件 | 處方：枸杞 50g（煮袋） |
| 步驟 | 1. 備料<br>2. 按「下鍋」<br>3. 煮好裝袋 |
| 預期結果 | 按「下鍋」時扣庫存，不是給病人時 |

#### TC-WTR-002：水藥煮後病人不要
| 項目 | 內容 |
|------|------|
| 前置條件 | 已煮好，病人不要 |
| 步驟 | 1. 標記「報廢」 |
| 預期結果 | 庫存已扣（不回復），記錄損耗 |

---

## 3. Reset 機制

### 3.1 測試資料 Reset 腳本

```bash
# reset-test-data.sh

# 1. 清除所有交易資料
DELETE FROM C_Order WHERE AD_Client_ID = [TestClient];
DELETE FROM C_Invoice WHERE AD_Client_ID = [TestClient];
DELETE FROM M_InOut WHERE AD_Client_ID = [TestClient];

# 2. 重置庫存到初始值
UPDATE M_StorageOnHand
SET QtyOnHand = [InitialQty]
WHERE M_Product_ID IN (SELECT M_Product_ID FROM M_Product WHERE Value LIKE 'TCM%' OR Value LIKE 'HRB%');

# 3. 清除病人就診紀錄（保留基本資料）
DELETE FROM [VisitRecord] WHERE AD_Client_ID = [TestClient];

# 4. 重置病人標記
UPDATE C_BPartner
SET [Flags] = [InitialFlags]
WHERE AD_Client_ID = [TestClient] AND IsCustomer = 'Y';

# 5. 清除今日掛號
DELETE FROM [Registration] WHERE Created >= TODAY();

# 6. 重置預約（保留結構）
DELETE FROM [Appointment] WHERE AppointmentDate >= TODAY();
```

### 3.2 Reset 觸發方式

| 方式 | 說明 | 權限 |
|------|------|------|
| API 呼叫 | POST /api/test/reset | 僅測試環境 |
| 管理介面 | 設定 > 測試 > 重置資料 | 管理員 |
| 定時任務 | 每天凌晨 3:00 自動重置 | 系統 |

### 3.3 保留 vs 清除

| 資料類型 | 處理方式 |
|---------|---------|
| 使用者帳號 | 保留 |
| 藥品主檔 | 保留 |
| 廠商主檔 | 保留 |
| 病人基本資料 | 保留 |
| 處方組合 | 保留 |
| 庫存數量 | 重置到初始值 |
| 交易紀錄 | 清除 |
| 掛號紀錄 | 清除 |
| 預約紀錄 | 清除 |

---

## 4. 自動化測試

### 4.1 測試框架

| 層級 | 框架 | 涵蓋範圍 |
|------|------|---------|
| 單元測試 | Vitest | 元件、工具函式 |
| 元件測試 | Vue Test Utils | Vue 元件 |
| E2E 測試 | Playwright | 完整使用者流程 |
| API 測試 | 自訂腳本 | iDempiere API |

### 4.2 CI/CD 整合

```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm install
      - run: npm run test:unit
      - run: npm run test:e2e
```

---

## 5. 測試環境

### 5.1 環境配置

| 環境 | 用途 | iDempiere | Reset |
|------|------|-----------|-------|
| Local | 開發用 | 本機 Docker | 手動 |
| Dev | 整合測試 | 192.168.0.93 | 每日自動 |
| Staging | 驗收測試 | 獨立主機 | 需求時 |
| Prod | 正式環境 | 正式主機 | 禁止 |

### 5.2 測試資料隔離

```
正式 Client: GardenWorld (ID: 11)
測試 Client: TestClinic (ID: 1000000)

測試資料只存在 TestClinic，不影響 GardenWorld
```

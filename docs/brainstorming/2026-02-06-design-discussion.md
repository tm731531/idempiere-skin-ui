# iDempiere 醫療診所 UI 設計討論紀錄

> 日期：2026-02-06
> 專案：idempiere-new-skin-ui
> 目標：為醫療診所設計全新的 iDempiere 前端介面

---

## 討論背景

### 為什麼要做新 UI？

1. **彈性問題** - 現有 ZK 框架客製化困難，改一點東西要碰 Java
2. **已有 API** - iDempiere REST API plugin 已經完成，可以直接操作系統
3. **HTML 為基底** - 比 ZK 更好修改、更好維護
4. **OSGi 相容** - 需要能打包成 iDempiere plugin 散佈

### 技術選型決定

| 項目 | 決定 | 原因 |
|------|------|------|
| 框架 | Vue 3 + Vite + TypeScript | 漸進式、打包小、生態系好 |
| Runtime | 要快、要加密混淆 | 保護程式碼 |
| Build | 不在意複雜度 | 反正要封裝到 OSGi |
| 部署 | OSGi bundle | 可散佈給其他 iDempiere 用戶 |

---

## 專案定位：醫療診所管理系統

### 目標使用者

| 角色 | 工作內容 | 設備 | UI 優先級 |
|------|----------|------|----------|
| 櫃檯/掛號 | 刷健保卡、排隊叫號、結帳 | 平板 > 電腦 | 平板優先 |
| 醫生 | 看診、開藥、查庫存 | 平板 > 電腦 | 平板優先 |
| 藥師/藥局 | 領藥、配藥、扣庫存 | 手機 | 手機優先 |
| 庫管（4人） | 進貨、盤點、調撥 | 手機 | 手機優先 |
| 採購（2人，同時也是庫管） | 下單給廠商 | 手機 | 手機優先 |

### 使用者限制

> 「醫療業的人光照顧病人都不夠了，實務上他們能接受的就是 WEB，盡量用手機掃該掃的，剩下頂多 KEY 數字，要寫字醫生的字都超詭異的」

**設計原則：**
- Mobile First（手機優先）
- 掃碼為主，減少打字
- 數字鍵盤，不用全鍵盤
- 大按鈕、一頁一件事

---

## 核心問題與解法

### 問題一：採購/庫管不同步

**現況痛點：**
```
4 個庫管各自囤貨
├─ 採購 A、B 各自下單，不知道對方訂了什麼
├─ 庫管 1、2 有採購權，各自囤一輪
├─ 庫管 3、4 無採購權，不知道庫存和未來
└─ 結果：醫生喊沒藥、採購狂訂、位置不夠
```

**解法：單一真相來源**
```
統一庫存視圖 → 所有人看到一樣的數字
統一訂單視圖 → 所有採購單互相看得到
在途庫存顯示 → 訂了什麼、什麼時候到
任務制盤點   → 誰有空誰接，做完打勾
動態顯示     → 誰在幹嘛一目了然
```

### 問題二：iDempiere 欄位太多

**現況痛點：**
- M_Product 有 30+ 欄位
- C_BPartner 有 40+ 欄位
- 對醫療人員來說太複雜

**解法：極簡介面 + 預設值**
```
iDempiere 後台：設定欄位預設值
新 UI：只顯示必要欄位
使用者：只填真正要思考的欄位
```

### 問題三：ERP 術語太難懂

**用語轉換：**

| iDempiere 術語 | 醫生聽得懂的說法 |
|---------------|-----------------|
| 在途訂單 | 「已訂貨，X天後到」 |
| 庫存量 | 「現在有 N 個」 |
| 安全庫存 | 「建議補貨」 |
| 採購建議 | 「要不要買？」 |

---

## 藥品單位設計

### 問題：同一藥品有多種單位

> 「比方說枸杞，進來一定是一包一包的，但是賣有分 G 也有包，也有幫客戶煮好裝袋的」

### 解法：多重單位換算

```
進貨：一包一包（1包 = 500g）
        ↓
    ┌───────────┐
    │   庫存    │
    │ 枸杞 3包  │
    │ (共1500g) │
    └───────────┘
        ↓
   ┌────┼────┬────────┐
   ↓    ↓    ↓        ↓
 賣散的 賣整包 煮好裝袋
 (秤g)  (1包) (扣原料)
```

### 各類型藥品單位

| 類型 | 進貨單位 | 庫存單位 | 開藥單位 | 扣庫存時機 |
|------|---------|---------|----------|-----------|
| 科中 | 罐 | 罐 | g | 配藥時 |
| 藥粉 | 包/罐 | g | g | 配藥時 |
| 袋裝 | 包 | g | g | 配藥時 |
| 水藥-賣散 | 包 | g | g | 秤完交付時 |
| 水藥-賣整包 | 包 | 包 | 包 | 交付時 |
| 水藥-煮袋 | 包 | g | 帖/份 | **下鍋時** |

### 關鍵決定：扣庫存時機

> 「煮下去就要扣了啊，客戶退了就只能報廢，怎麼可能撈起來給其他人，每一個客戶的單都是獨一無二的」

**水藥煮袋流程：**
```
醫生開單 → 藥房備料 → 下鍋煮 → 扣庫存（這時扣）
                          ↓
                     裝袋給客人
                          ↓
              客人不要？→ 報廢（庫存已扣）
```

---

## 庫存扣減機制

### 問題：藥房沒時間輸入克數

> 「科中藥粉這些，你會怎麼進行扣？如果是 G，藥房小姐他們是沒有時間鳥你去進行扣 G 的」

### 解法：醫生開的量 = 扣的量

```
醫生開藥：甘草湯 50g
           ↓
    藥房小姐只要按
    [配藥完成] ← 一個按鈕
           ↓
系統自動扣：甘草湯 -50g
```

**藥房不用再輸入數字，醫生已經開好了。**

### Double Check 機制

**問題：系統庫存 vs 實際庫存可能不符**

> 「處方 50，系統剩下 41，實際剩下 60，這種 Double Check 怎麼辦？」

**解法：開罐時校正**
```
系統偵測：這罐扣完了
        ↓
彈出確認：要開新罐嗎？
        ↓
請確認目前庫存數量：
系統紀錄：2 罐
實際數量：[___] 罐 ← 輸入一個數字
        ↓
差異記錄（誰、何時、原因）
```

---

## 藥房調撥機制

### 問題：藥房不夠要上樓拿

> 「現在是藥房人員自己上去拿，畢竟講真的今天萬一來的都是感冒的病人就是要甘草湯，藥房裡只有一罐，你也不可能提前知道」

### 解法：掃碼調撥（最低負擔）

```
藥房人員上樓拿藥時：
1. 到庫房
2. 掃藥品條碼
3. 輸入數量（數字鍵盤）
4. 完成

← 3 秒完成，自動記錄從庫房→藥房
```

### 關鍵：調撥跟開藥脫鉤

> 「醫生開藥就自動調撥也有可能醫生開一開但是客人出去靠北後回來，藥拆了退回或修改這樣也很危險」

```
醫生開藥 → 只是「處方」
            ↓
藥房配藥 → 實際扣庫存（這時才扣）
            ↓
如果藥房不夠 → 上樓掃碼拿 → 記錄調撥
            ↓
給病人 → 完成
```

---

## 庫管合作機制

### 問題：4 個庫管各管各的

> 「當然希望庫存可以打破隔閡，叫他們四個給我合作起來啊」

### 解法：用系統逼他們合作

**1. 統一視圖 - 四個人看到一樣的**
```
庫存總覽（所有人看到同一個畫面）

甘草湯
├─ 藥房：41g（已開封）
├─ 庫房：2 罐
└─ 前台：0

最後更新：庫管B，10:32
```

**2. 任務制盤點 - 不是誰負責哪區，是分配任務**
```
今日盤點任務

□ 科中 A-K（未認領）        [接單]
☑ 科中 L-Z（庫管A，進行中）
✓ 藥粉區（庫管C，已完成）
□ 水藥區（未認領）          [接單]
```

**3. 動態顯示 - 誰在幹嘛一目了然**
```
現在動態

🟢 庫管A - 正在盤科中區
🟢 庫管B - 剛完成入庫（廠商X，5項）
⚪ 庫管C - 離線
🟢 庫管D - 正在調撥（庫房→藥房）
```

**4. 紀錄透明 - 每個動作都有名字**

做了什麼、誰做的、一清二楚，沒人可以裝死。

---

## 掛號流程設計

### 刷卡後顯示資訊

> 「B（基本資料+過去病歷），而且有時候還要帶出這個病人是不是會靠北的紀錄」

```
┌─────────────────────────────────────┐
│  王大明                    ⚠️ 注意   │ ← 有標記的會顯示
│                                     │
│  生日：1975/03/15（49歲）            │
│  健保卡號：A123456789               │
│                                     │
│  就診紀錄：共 12 次                  │
│  ├─ 2024/01/20 感冒                 │
│  ├─ 2024/01/05 腸胃不適             │
│  └─ 更多...                         │
│                                     │
│  ⚠️ 備註：對收費敏感，說話要小心      │
│                                     │
│  [取消] [確認掛號]                   │
└─────────────────────────────────────┘
```

### 病人標記類型

| 標記 | 說明 | 誰可以加 |
|------|------|---------|
| ⚠️ 注意 | 難搞、愛抱怨 | 櫃檯、醫生 |
| 💊 過敏 | 藥物過敏史 | 醫生 |
| ❤️ VIP | 重要客人 | 櫃檯、老闆 |
| 🔄 慢性 | 慢性病患、固定回診 | 醫生 |

### 取消機制

> 「有一些人刷卡完後靠北很多事情然後拿卡就走了，所以前台必須要有一個刷卡後退的機制」

| 情境 | 動作 | 系統處理 |
|------|------|---------|
| 刷卡後、掛號前 | 按「取消」 | 不留紀錄，當沒來過 |
| 掛號後、看診前 | 退掛 | 留紀錄「掛號後取消」 |
| 看診後、領藥前 | 不付錢 | 藥報廢、標記欠款 |

---

## 叫號機制設計

### 問題：排隊爭議

> 「叫號的部分是認卡片，誰先給卡處理好沒靠北就優先，因為之前按照人有人就在那邊說我先來，或是我只是去旁邊休息一下但是早就到了」

### 解法：認卡不認人

> 「櫃台會按照每個人繳卡的順序一個一個排在鍵盤上」

```
病人交卡 → 櫃檯刷卡 → 系統自動排隊（按刷卡順序）
              ↓
         卡片放鍵盤上（實體備份）
```

**叫號權在櫃檯，不是醫生。**

---

## 醫生看診畫面

### 候診人數提醒

> 「目前病人相關資訊，太多沒意義，但是候診有多少人也需要資料，不這樣她會抓著病人聊很久」

```
┌─────────────────────────────────────────────────────┐
│  看診中：王大明（49歲）              候診：12 人 ⏰  │ ← 提醒用
│─────────────────────────────────────────────────────│
│                                                     │
│  ⚠️ 注意：對收費敏感                                │
│  💊 過敏：盤尼西林                                  │
│                                                     │
│  過去就診：                                         │
│  ├─ 01/20 感冒 → 銀翹散、甘草湯                     │
│  └─ [更多...]                                       │
│                                                     │
│─────────────────────────────────────────────────────│
│  本次開藥：                                         │
│  [+新增藥品]                                        │
│─────────────────────────────────────────────────────│
│                    [看診完成]                        │
└─────────────────────────────────────────────────────┘
```

### 候診人數顯示邏輯

| 候診人數 | 顯示 | 暗示 |
|---------|------|------|
| 0-3 人 | 🟢 3 人 | 慢慢來沒關係 |
| 4-10 人 | 🟡 8 人 | 該加快了 |
| 10+ 人 | 🔴 15 人 ⏰ | 別聊了！ |

---

## 處方組合維護

### 問題：人腦資料庫

> 「常用藥其實醫生有一個 LIST，目前有點類似協議，就是他講藥名然後藥房小姐會自己轉化成成分，但是這個也是一個問題，換人就會亂會錯」

```
醫生說：「感冒方」
            ↓
    藥房小姐 A（老手）
    知道 = 銀翹散30g + 甘草湯50g + 桔梗20g
            ↓
    藥房小姐 B（新人）
    ？？？ 這是什麼？
```

### 解法：系統化處方組合

> 「C（兩者並行），一定要有現有的，後續醫生一定會慢慢增長，因為病會進化」

**初期：一次性建檔**
```
訪談藥房小姐
「醫生說 X，你都配什麼？」
        ↓
全部建進系統
```

**日常：醫生自己擴充**
```
開藥時
        ↓
[儲存為新組合]
        ↓
命名：「新冠加強方」
        ↓
下次直接選用
```

---

## 看診後流程

### 一進一出原則

> 「病人就去外面等，藥房小姐按照順序配藥，配好後會放櫃台，櫃台按照順序叫人來付錢，付完走人」

```
醫生按「看診完成」
        ↓
病人出來 → 等候區坐著等
        ↓
藥房看到處方 → 按順序配藥
        ↓
配好 → 藥放櫃檯
        ↓
櫃檯叫號 → 「王大明，領藥」
        ↓
付錢 → 拿藥 → 走人
```

---

## 退藥退費處理

### 各種情境

| 類型 | 藥品處理 | 金額處理 | 庫存 | 備註 |
|------|---------|---------|------|------|
| 還沒配 | 無 | 全退 | 不動 | 正常 |
| 退費不退藥 | 病人拿走 | 被迫退 | 已扣 | 標記奧客 ⚠️ |
| 退藥不退費 | 報廢 | 不退 | 損耗 | 品質問題 |
| 部分退 | 部分報廢 | 部分退 | 調整 | 記錄原因 |

**重點：每筆退都要記錄原因 + 誰處理的**

---

## 慢性病領藥

```
刷健保卡
    ↓
系統判斷：有慢性處方箋
    ↓
┌─────────────────────────────────────┐
│  慢性處方箋：高血壓用藥              │
│  ├─ 上次領：01/15                   │
│  ├─ 本次可領：02/15 ✅ 到期可領     │
│  └─ 藥品：降壓藥 30日份             │
│                                     │
│  [直接領藥] [需要看診]               │
└─────────────────────────────────────┘
    ↓
不用排隊看診 → 直接配藥 → 結帳 → 走人
```

---

## 預約掛號

### 約日期不約時段

> 「預約都只是幫預約日期，因為醫生一天看的量有限，我們不可能讓他無限的看，健保不准，國家也不願意」

```
每日看診上限

例如：每天最多 50 人

01/28（二）  已預約 32 / 50
01/29（三）  已預約 48 / 50  ⚠️
01/30（四）  已預約 50 / 50  🔴 滿
01/31（五）  已預約 12 / 50
```

### 現場 vs 預約

| 類型 | 處理方式 |
|------|---------|
| 有預約 | 來就能看（在當日額度內） |
| 現場掛號 | 看當日額度還有沒有空位 |
| 額滿 | 「今天滿了，要不要約明天？」 |

---

## 健保申報

### 需求

> 「C（直接串接健保署），因為要看點數，避免病人越看越虧，甚至還會被告」

```
系統要做：
• 每筆看診計算健保點數
• 即時顯示「這個病人賺/虧」
• 自動產出申報資料上傳健保署
```

---

## 報表統計

### 老闆現況

> 「報表統計是一定要的，但是現在老闆們光是看診都來不及了，目前他們只能說『啊有賺錢』，就這樣，但是細流像完全不能看不能管」

### 系統要提供

**今日總覽**
```
看診人數：45 人
營收：$28,500
退款：$1,200（3筆）
損耗：$350（2筆報廢）
淨收入：$26,950
```

**庫存警示**
```
🔴 甘草湯 - 剩 1 罐，要補貨
🟡 銀翹散 - 剩 3 罐，快不夠
```

**月報表**
```
本月營收：$850,000
vs 上月：+5%
熱門藥品：甘草湯、銀翹散、枸杞
庫存週轉：12 天
```

---

## 待確認項目

| 項目 | 狀態 | 備註 |
|------|------|------|
| 權限管理 | 待討論 | 誰能看什麼、誰能改什麼 |
| 健保申報細節 | 待研究 | 需要了解健保署 API |
| 負評處理 | 暫不處理 | 目前只管 Google 評論 |

---

## 下一步

1. 整理正式需求規格文件
2. 繪製流程圖
3. 設計 UI Wireframe
4. 定義測試情境與測試資料
5. 設計 Reset 機制（測試環境用）

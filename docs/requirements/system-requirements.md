# 系統需求規格書

> 專案：iDempiere 醫療診所 UI
> 版本：1.0
> 日期：2026-02-06

---

## 1. 專案概述

### 1.1 目標

為醫療診所開發全新的 iDempiere 前端介面，基於現有 REST API，提供：
- Mobile First 設計
- 極簡操作介面
- 即時庫存管理
- 健保申報整合

### 1.2 技術架構

| 項目 | 技術選型 |
|------|---------|
| 前端框架 | Vue 3 + Vite + TypeScript |
| API 介面 | iDempiere REST API |
| 部署方式 | OSGi Bundle |
| 程式碼保護 | Minify + Obfuscate |

### 1.3 設計原則

1. **Mobile First** - 手機優先，平板/電腦自適應
2. **掃碼為主** - 減少打字輸入
3. **一頁一事** - 每個畫面專注一件事
4. **即時同步** - 所有人看到同一份資料

---

## 2. 使用者角色

### 2.1 角色定義

| 角色 | 職責 | 主要設備 | 權限等級 |
|------|------|---------|---------|
| 櫃檯 | 掛號、叫號、結帳 | 平板 | 中 |
| 醫生 | 看診、開藥 | 平板 | 高 |
| 藥房 | 配藥、扣庫存 | 手機 | 中 |
| 庫管 | 進貨、盤點、調撥 | 手機 | 中 |
| 採購 | 下單採購 | 手機 | 中 |
| 老闆 | 報表、管理 | 電腦/平板 | 最高 |

### 2.2 人員現況

- 庫管：4 人
- 採購：2 人（同時也是庫管）
- 目標：未來收斂為 1 人採購

---

## 3. 功能模組

### 3.1 登入模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 帳號密碼登入 | 基本認證 | P0 |
| 記住登入 | 下次自動登入 | P1 |
| 角色切換 | 一人多角色 | P2 |

### 3.2 掛號模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 健保卡讀取 | 刷卡取得病人資料 | P0 |
| 病歷顯示 | 過去就診紀錄 | P0 |
| 病人標記 | 注意/過敏/VIP/慢性 | P0 |
| 看診類型 | 初診/複診/慢性領藥 | P0 |
| 選擇醫生 | 預設一位，可擴充 | P1 |
| 取消掛號 | 刷卡後反悔 | P0 |
| 預約管理 | 約日期、每日上限 | P1 |

### 3.3 候診模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 候診列表 | 按刷卡順序排列 | P0 |
| 叫號功能 | 櫃檯控制 | P0 |
| 順序調整 | 插隊/往上/往下 | P1 |
| 暫離標記 | 病人暫時離開 | P2 |
| 候診螢幕 | 給病人看的叫號畫面 | P1 |

### 3.4 看診模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 病人資訊 | 基本資料+病歷+標記 | P0 |
| 候診人數 | 提醒醫生別聊太久 | P0 |
| 開藥介面 | 搜尋+常用藥 | P0 |
| 庫存顯示 | 開藥時顯示庫存狀態 | P0 |
| 處方組合 | 醫生自訂常用組合 | P0 |
| 看診完成 | 送出處方 | P0 |

### 3.5 配藥模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 待配藥列表 | 按看診完成順序 | P0 |
| 處方明細 | 藥品+劑量 | P0 |
| 配藥完成 | 一鍵扣庫存 | P0 |
| 劑量調整 | 實際與處方不同時 | P1 |
| 調撥提示 | 藥房不夠時提示 | P1 |

### 3.6 結帳模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 待結帳列表 | 藥配好才出現 | P0 |
| 叫號結帳 | 通知病人來付錢 | P0 |
| 金額計算 | 自動計算 | P0 |
| 收款確認 | 現金/刷卡 | P0 |
| 退款處理 | 各種退款情境 | P1 |

### 3.7 庫存模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 庫存總覽 | 三個倉位一目了然 | P0 |
| 即時更新 | 所有人看同一份 | P0 |
| 低庫存警示 | 紅黃綠燈號 | P0 |
| 掃碼調撥 | 跨倉位移動 | P0 |
| 盤點任務 | 任務制、可認領 | P1 |
| 差異調整 | 記錄原因 | P1 |

### 3.8 採購模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 採購建議 | 基於庫存水位 | P1 |
| 建立訂單 | 選廠商+選藥品 | P0 |
| 訂單列表 | 所有採購單 | P0 |
| 在途顯示 | 已訂、幾天後到 | P0 |
| 到貨入庫 | 掃碼入庫 | P0 |

### 3.9 慢性病模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 處方箋識別 | 刷卡自動判斷 | P0 |
| 領藥資格 | 是否到期可領 | P0 |
| 直接領藥 | 跳過看診流程 | P0 |

### 3.10 健保模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 點數計算 | 每筆看診計算 | P0 |
| 盈虧顯示 | 這個病人賺/虧 | P1 |
| 申報產出 | 產出申報檔案 | P0 |
| 自動上傳 | 串接健保署 | P2 |

### 3.11 報表模組

| 功能 | 說明 | 優先級 |
|------|------|--------|
| 今日總覽 | 人數/營收/退款/損耗 | P0 |
| 庫存警示 | 需補貨清單 | P0 |
| 月報表 | 營收趨勢 | P1 |
| 熱門藥品 | 排行榜 | P2 |
| 庫存週轉 | 週轉天數 | P2 |

---

## 4. 資料模型

### 4.1 藥品 (M_Product)

| 欄位 | iDempiere 對應 | 必填 | 說明 |
|------|---------------|------|------|
| 藥品名稱 | Name | Y | 顯示名稱 |
| 藥品代碼 | Value | Y | 健保碼或內部碼 |
| 類型 | M_Product_Category_ID | Y | 科中/藥粉/水藥等 |
| 單位 | C_UOM_ID | Y | 罐/g/包等 |
| 儲存條件 | 自訂屬性 | N | 冷藏/避光/常溫 |
| 採購單位 | 自訂欄位 | Y | 跟廠商買的單位 |
| 換算比例 | 自訂欄位 | Y | 1罐=200g |
| 最低庫存 | 自訂欄位 | Y | 補貨水位 |

### 4.2 藥品類型與單位

| 類型 | 進貨單位 | 庫存單位 | 開藥單位 | 扣庫存時機 |
|------|---------|---------|----------|-----------|
| 科中 | 罐 | 罐 | g | 配藥時 |
| 藥粉 | 包/罐 | g | g | 配藥時 |
| 袋裝 | 包 | g | g | 配藥時 |
| 水藥-散賣 | 包 | g | g | 交付時 |
| 水藥-整包 | 包 | 包 | 包 | 交付時 |
| 水藥-煮袋 | 包 | g | 帖 | 下鍋時 |

### 4.3 病人 (C_BPartner)

| 欄位 | iDempiere 對應 | 必填 | 說明 |
|------|---------------|------|------|
| 姓名 | Name | Y | 病人姓名 |
| 健保卡號 | Value | Y | 唯一識別 |
| 生日 | 自訂欄位 | Y | 年齡計算 |
| 電話 | 自訂欄位 | N | 聯絡用 |
| 標記 | 自訂欄位 | N | 注意/過敏/VIP/慢性 |
| 備註 | Description | N | 特殊註記 |

### 4.4 廠商 (C_BPartner)

| 欄位 | iDempiere 對應 | 必填 | 說明 |
|------|---------------|------|------|
| 廠商名稱 | Name | Y | 顯示名稱 |
| 廠商代碼 | Value | Y | 內部代碼 |
| IsVendor | IsVendor | Y | 設為 true |
| 聯絡電話 | 自訂欄位 | N | 訂貨用 |

### 4.5 倉庫 (M_Warehouse)

| 倉庫名稱 | 用途 |
|---------|------|
| 藥房 | 配藥用，優先扣這裡 |
| 庫房 | 備貨用，藥房不夠來這拿 |
| 前台 | 少量常用藥 |

### 4.6 處方組合（自訂）

| 欄位 | 說明 |
|------|------|
| 組合名稱 | 醫生自訂名稱，如「感冒方」 |
| 所屬醫生 | 哪位醫生的組合 |
| 藥品明細 | 藥品+劑量清單 |

---

## 5. 介面規格

### 5.1 庫存狀態顯示

| 狀態 | 顏色 | 條件 |
|------|------|------|
| 充足 | 🟢 綠 | 藥房庫存 >= 需求 |
| 需調撥 | 🟡 黃 | 藥房不夠，但庫房有 |
| 在途中 | 🟡 黃 | 總庫存不夠，但有訂單 |
| 缺貨 | 🔴 紅 | 完全沒有 |

### 5.2 候診人數顯示

| 人數 | 顏色 | 意涵 |
|------|------|------|
| 0-3 | 🟢 綠 | 正常 |
| 4-10 | 🟡 黃 | 該加快 |
| 10+ | 🔴 紅 | 別聊了 |

### 5.3 病人標記

| 標記 | 圖示 | 說明 |
|------|------|------|
| 注意 | ⚠️ | 難搞、愛抱怨 |
| 過敏 | 💊 | 藥物過敏史 |
| VIP | ❤️ | 重要客人 |
| 慢性 | 🔄 | 慢性病患 |
| 欠款 | 💰 | 有未付款紀錄 |

---

## 6. 非功能需求

### 6.1 效能

| 項目 | 目標 |
|------|------|
| 頁面載入 | < 2 秒 |
| API 回應 | < 500ms |
| 離線支援 | 基本瀏覽（P2） |

### 6.2 安全性

| 項目 | 說明 |
|------|------|
| 認證 | JWT Token |
| 授權 | 角色權限控制 |
| 程式碼 | 混淆 + Minify |
| 傳輸 | HTTPS |

### 6.3 相容性

| 項目 | 支援範圍 |
|------|---------|
| 瀏覽器 | Chrome, Safari, Edge (最新兩版) |
| 手機 | iOS 15+, Android 10+ |
| 螢幕 | 320px ~ 1920px |

---

## 7. 整合需求

### 7.1 iDempiere API

| API | 用途 |
|-----|------|
| Auth API | 登入認證 |
| Models API | CRUD 操作 |
| Process API | 單據動作 |

### 7.2 健保署

| 功能 | 說明 |
|------|------|
| 讀卡機 | 讀取健保卡 |
| 申報上傳 | 串接健保署系統 |

### 7.3 硬體

| 設備 | 用途 |
|------|------|
| 健保卡讀卡機 | 掛號用 |
| 條碼掃描器 | 藥品掃碼 |
| 標籤印表機 | 藥袋列印（P2） |

---

## 8. 優先級說明

| 等級 | 說明 |
|------|------|
| P0 | 必要功能，第一版必須完成 |
| P1 | 重要功能，第一版盡量完成 |
| P2 | 加值功能，後續版本再做 |

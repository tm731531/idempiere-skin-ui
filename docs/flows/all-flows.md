# 系統流程圖

> 專案：iDempiere 醫療診所 UI
> 版本：1.0
> 日期：2026-02-06

---

## 1. 系統總覽

```
┌─────────────────────────────────────────────────────────────────┐
│                        醫療診所系統                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    │
│   │  掛號   │───→│  看診   │───→│  配藥   │───→│  結帳   │    │
│   └─────────┘    └─────────┘    └─────────┘    └─────────┘    │
│        ↑                              ↑                        │
│        │                              │                        │
│   ┌─────────┐                   ┌─────────┐                   │
│   │  預約   │                   │  庫存   │←─────────────┐    │
│   └─────────┘                   └─────────┘              │    │
│                                      ↑                   │    │
│                                      │                   │    │
│                                 ┌─────────┐         ┌─────────┐│
│                                 │  採購   │────────→│  入庫   ││
│                                 └─────────┘         └─────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 看診循環

### 2.1 完整流程

```
病人到達
    │
    ▼
┌─────────────────┐
│   刷健保卡      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│   顯示病人資料   │────→│   選擇看診類型   │
│   • 姓名/年齡   │     │   • 初診        │
│   • 過去病歷   │     │   • 複診        │
│   • 標記警示   │     │   • 慢性領藥    │
└─────────────────┘     └────────┬────────┘
                                 │
              ┌──────────────────┼──────────────────┐
              │                  │                  │
              ▼                  ▼                  ▼
        ┌───────────┐      ┌───────────┐      ┌───────────┐
        │   初診    │      │   複診    │      │ 慢性領藥  │
        │ 填額外資料│      │  直接掛號 │      │ 直接配藥  │
        └─────┬─────┘      └─────┬─────┘      └─────┬─────┘
              │                  │                  │
              └────────┬─────────┘                  │
                       ▼                            │
              ┌─────────────────┐                   │
              │   確認掛號      │                   │
              └────────┬────────┘                   │
                       │                            │
                       ▼                            │
              ┌─────────────────┐                   │
              │   進入候診      │                   │
              └────────┬────────┘                   │
                       │                            │
                       ▼                            │
              ┌─────────────────┐                   │
              │   櫃檯叫號      │                   │
              └────────┬────────┘                   │
                       │                            │
                       ▼                            │
              ┌─────────────────┐                   │
              │   醫生看診      │                   │
              │   • 問診       │                   │
              │   • 開藥       │                   │
              │   • 查庫存     │                   │
              └────────┬────────┘                   │
                       │                            │
                       ▼                            │
              ┌─────────────────┐                   │
              │   看診完成      │                   │
              └────────┬────────┘                   │
                       │                            │
                       └────────────┬───────────────┘
                                    ▼
                           ┌─────────────────┐
                           │   藥房配藥      │
                           │   • 看處方     │
                           │   • 包藥       │
                           │   • 按完成扣庫存│
                           └────────┬────────┘
                                    │
                                    ▼
                           ┌─────────────────┐
                           │   藥放櫃檯      │
                           └────────┬────────┘
                                    │
                                    ▼
                           ┌─────────────────┐
                           │   櫃檯叫號結帳   │
                           └────────┬────────┘
                                    │
                                    ▼
                           ┌─────────────────┐
                           │   病人付錢拿藥   │
                           └────────┬────────┘
                                    │
                                    ▼
                                  完成
```

### 2.2 掛號取消流程

```
                    刷卡後
                       │
         ┌─────────────┼─────────────┐
         │             │             │
         ▼             ▼             ▼
    ┌─────────┐   ┌─────────┐   ┌─────────┐
    │ 正常掛號 │   │ 取消掛號 │   │ 病人跑掉 │
    └────┬────┘   └────┬────┘   └────┬────┘
         │             │             │
         ▼             ▼             ▼
    進入候診      不留紀錄       留「取消」紀錄
```

### 2.3 叫號機制

```
病人交健保卡
       │
       ▼
┌─────────────────┐
│   櫃檯刷卡      │
│   按刷卡順序排隊 │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   卡片放鍵盤上   │
│  （實體順序備份）│
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────┐
│   候診列表                          │
│                                     │
│   1. 王大明 ✅ 已報到 09:01        │
│   2. 李小華 ✅ 已報到 09:03        │
│   3. 陳美美 ✅ 已報到 09:05        │
│                                     │
│   [往上] [往下] [插隊] [暫離]       │
└─────────────────────────────────────┘
         │
         │ 櫃檯按「叫號」
         ▼
┌─────────────────┐
│   螢幕/喇叭顯示  │
│  「1號 王大明」  │
└────────┬────────┘
         │
         ▼
    病人進診間
```

---

## 3. 採購循環

### 3.1 完整流程

```
┌─────────────────┐
│   庫存低於水位   │
│   或手動建單    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   選擇廠商      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   選擇藥品+數量  │
│   • 掃碼加入    │
│   • 搜尋加入    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   確認採購單    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   送出訂單      │
│   狀態：已訂貨   │
└────────┬────────┘
         │
         │ 等待到貨（約2天）
         ▼
┌─────────────────┐
│   廠商送貨到    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   掃碼入庫      │
│   • 掃藥品條碼  │
│   • 確認數量   │
│   • 選擇倉位   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   入庫完成      │
│   庫存更新      │
└─────────────────┘
```

### 3.2 採購單狀態

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│  草稿   │───→│  已訂貨  │───→│  部分到  │───→│  已完成  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
                    │
                    │ 取消
                    ▼
               ┌─────────┐
               │  已取消  │
               └─────────┘
```

---

## 4. 庫存管理

### 4.1 庫存扣減流程

```
醫生開藥
    │
    ▼
┌─────────────────┐
│   處方建立      │
│  （尚未扣庫存）  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   藥房配藥      │
└────────┬────────┘
         │
         │ 藥房庫存足夠？
         │
    ┌────┴────┐
    │ 是      │ 否
    ▼         ▼
┌───────┐ ┌─────────────────┐
│ 配藥  │ │   上樓掃碼調撥   │
└───┬───┘ │   庫房 → 藥房   │
    │     └────────┬────────┘
    │              │
    └──────┬───────┘
           ▼
┌─────────────────┐
│   按「配藥完成」 │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   系統自動扣庫存 │
│  （按處方劑量）  │
└─────────────────┘
```

### 4.2 調撥流程

```
藥房人員發現不夠
         │
         ▼
┌─────────────────┐
│   上樓到庫房    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   掃藥品條碼    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   輸入數量      │
│  （數字鍵盤）   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   確認調撥      │
│   從：庫房      │
│   到：藥房      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   系統記錄      │
│   • 誰         │
│   • 何時       │
│   • 什麼藥     │
│   • 多少       │
└─────────────────┘
```

### 4.3 盤點流程

```
┌─────────────────┐
│   建立盤點任務   │
│   • 科中 A-K   │
│   • 科中 L-Z   │
│   • 藥粉區     │
│   • 水藥區     │
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────┐
│   任務池                            │
│                                     │
│   □ 科中 A-K（未認領）    [接單]    │
│   □ 科中 L-Z（未認領）    [接單]    │
│   □ 藥粉區（未認領）      [接單]    │
│   □ 水藥區（未認領）      [接單]    │
└─────────────────────────────────────┘
         │
         │ 庫管按「接單」
         ▼
┌─────────────────┐
│   庫管盤點中    │
│   掃碼 → 輸數量 │
└────────┬────────┘
         │
         │ 系統 vs 實際 比對
         │
    ┌────┴────┐
    │ 相符    │ 不符
    ▼         ▼
┌───────┐ ┌─────────────────┐
│ 完成  │ │   輸入差異原因   │
└───────┘ │   • 之前少算    │
          │   • 損耗       │
          │   • 其他       │
          └────────┬────────┘
                   │
                   ▼
          ┌─────────────────┐
          │   調整庫存      │
          │   記錄調整紀錄   │
          └─────────────────┘
```

### 4.4 Double Check（開罐校正）

```
配藥過程中
    │
    ▼
系統偵測：這罐扣完了
    │
    ▼
┌─────────────────────────────────────┐
│   要開新罐嗎？                       │
│                                     │
│   請確認目前庫存數量：                │
│                                     │
│   系統紀錄：2 罐                     │
│   實際數量：[___] 罐                 │
│                                     │
│   [確認開罐]                         │
└─────────────────────────────────────┘
    │
    │ 輸入實際數量
    │
    ┌────┴────┐
    │ 相符    │ 不符
    ▼         ▼
┌───────┐ ┌─────────────────┐
│ 開新罐│ │   記錄差異      │
│ 繼續  │ │   調整庫存      │
└───────┘ └─────────────────┘
```

---

## 5. 退藥退費流程

### 5.1 退款類型判斷

```
病人要求退
    │
    ▼
┌─────────────────────────────────────┐
│   目前狀態？                         │
└────────┬────────────────────────────┘
         │
    ┌────┼────────────┬───────────────┐
    │    │            │               │
    ▼    ▼            ▼               ▼
┌──────┐┌──────┐ ┌──────────┐   ┌──────────┐
│未配藥││已配藥│ │已配未付款 │   │已付款已拿│
└──┬───┘└──┬───┘ └────┬─────┘   └────┬─────┘
   │       │          │              │
   ▼       ▼          ▼              ▼
全額退   藥報廢     藥報廢        視情況
庫存不動  退款      標記欠款      部分退
```

### 5.2 退費不退藥（奧客）

```
病人拿了藥，吵著要退錢
         │
         ▼
┌─────────────────┐
│   藥已拿走      │
│   無法回收      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   被迫退款      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   標記病人 ⚠️   │
│   「有退費紀錄」 │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   記錄損失      │
│   列入報表      │
└─────────────────┘
```

---

## 6. 預約流程

### 6.1 電話預約

```
病人打電話
    │
    ▼
┌─────────────────┐
│   櫃檯查日期    │
│   額度狀態      │
└────────┬────────┘
         │
         │ 有空位？
         │
    ┌────┴────┐
    │ 是      │ 否
    ▼         ▼
┌───────────────┐ ┌───────────────┐
│  輸入姓名/電話 │ │  建議其他日期  │
│  建立預約     │ └───────────────┘
└───────┬───────┘
        │
        ▼
┌───────────────┐
│  預約完成     │
│  告知日期     │
└───────────────┘
```

### 6.2 預約報到

```
預約當天，病人到達
         │
         ▼
┌─────────────────┐
│   刷健保卡      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   系統顯示      │
│   「有預約」    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   按「報到」    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   進入候診      │
│  （預約優先）   │
└─────────────────┘
```

---

## 7. 慢性病領藥流程

```
病人刷卡
    │
    ▼
┌─────────────────┐
│   系統識別      │
│   有慢性處方箋   │
└────────┬────────┘
         │
         │ 是否到期可領？
         │
    ┌────┴────┐
    │ 是      │ 否
    ▼         ▼
┌─────────────┐ ┌─────────────┐
│ 顯示可領資訊│ │ 顯示下次可領│
│             │ │ 日期        │
└──────┬──────┘ └─────────────┘
       │
       │ 選擇
       │
  ┌────┴────┐
  │直接領藥  │需要看診
  ▼         ▼
┌───────┐ ┌───────┐
│ 配藥  │ │ 掛號  │
│ 結帳  │ │ 看診  │
│ 完成  │ │ ...   │
└───────┘ └───────┘
```

---

## 8. 健保申報流程

```
每日看診
    │
    ▼
┌─────────────────┐
│   每筆看診記錄   │
│   計算健保點數   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   累積申報資料   │
└────────┬────────┘
         │
         │ 申報週期到
         ▼
┌─────────────────┐
│   產出申報檔案   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   上傳健保署    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   等待審核結果   │
└─────────────────┘
```

---

## 9. 水藥煮袋流程

```
醫生開水藥（煮袋）
         │
         ▼
┌─────────────────┐
│   藥房備料      │
│   秤藥材        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   下鍋煮        │
│   【此時扣庫存】 │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   煮好裝袋      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   交給病人      │
└────────┬────────┘
         │
         │ 病人不要？
         │
    ┌────┴────┐
    │ 收下    │ 不要
    ▼         ▼
 完成     ┌─────────────────┐
          │   報廢          │
          │  （庫存已扣）   │
          │   記錄損耗      │
          └─────────────────┘
```
